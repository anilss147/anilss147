name: üõ†Ô∏è Update GitHub README

on:
  schedule:
    - cron: '0 0 * * *'  # Runs every day at midnight
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout Repository
      uses: actions/checkout@v3

    - name: üõ†Ô∏è Install jq
      run: sudo apt-get install jq

    - name: ‚úèÔ∏è Generate README Sections
      run: |
        # Generate STATS block
        echo "<!-- STATS START -->" > stats_block.txt
        echo "![Anil's GitHub stats](https://github-readme-stats.vercel.app/api?username=anilss147&show_icons=true&theme=tokyonight)" >> stats_block.txt
        echo "![Top Langs](https://github-readme-stats.vercel.app/api/top-langs/?username=anilss147&layout=compact&theme=tokyonight)" >> stats_block.txt
        echo "<!-- STATS END -->" >> stats_block.txt

        # Generate GRAPH block
        echo "<!-- GRAPH START -->" > graph_block.txt
        echo "![GitHub Contribution Graph](https://github-profile-summary-cards.vercel.app/api/cards/profile-details?username=anilss147&theme=github)" >> graph_block.txt
        echo "<!-- GRAPH END -->" >> graph_block.txt

        # Generate PROJECTS block
        echo "<!-- PROJECTS START -->" > projects_block.txt
        curl -s "https://api.github.com/users/anilss147/repos?per_page=100" | jq -r '.[] | "üîπ [\(.name)](\(.html_url)) - \(.description // "No description.")"' >> projects_block.txt
        echo "<!-- PROJECTS END -->" >> projects_block.txt

        # Generate FOLLOWERS block
        echo "<!-- FOLLOWERS START -->" > followers_block.txt
        curl -s "https://api.github.com/users/anilss147/followers?per_page=10" | jq -r '.[] | "- [\(.login)](\(.html_url))"' >> followers_block.txt
        echo "<!-- FOLLOWERS END -->" >> followers_block.txt

    - name: üß© Replace Blocks in README.md
      run: |
        replace_section() {
          START=$1
          END=$2
          FILE=$3
          TMP=$(mktemp)
          awk "/$START/{flag=1;print;while(getline<\"$FILE\"){print};next}/$END/{flag=0} !flag" README.md > $TMP
          mv $TMP README.md
        }

        replace_section "<!-- STATS START -->" "<!-- STATS END -->" stats_block.txt
        replace_section "<!-- GRAPH START -->" "<!-- GRAPH END -->" graph_block.txt
        replace_section "<!-- PROJECTS START -->" "<!-- PROJECTS END -->" projects_block.txt
        replace_section "<!-- FOLLOWERS START -->" "<!-- FOLLOWERS END -->" followers_block.txt

    - name: ‚úÖ Commit and Push Changes
      run: |
        git config user.name "anilss147"
        git config user.email "anil@example.com"
        git add README.md
        git commit -m "üîÑ Auto-updated GitHub README with stats and projects" || echo "No changes to commit"
        git push
