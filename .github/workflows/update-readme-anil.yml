name: 🚀 Auto-Update README_2.md Monthly

on:
  schedule:
    - cron: "0 0 1 * *"  # Every 1st of the month
  workflow_dispatch:     # Allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v3

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: 🧠 Install PyGithub
        run: pip install PyGithub requests

      - name: 📝 Generate README_2.md
        run: |
          cat <<EOF > generate.py
          from github import Github

          USERNAME = "anilss147"
          g = Github()
          user = g.get_user(USERNAME)
          repos = user.get_repos()

          project_lines = []
          for i, repo in enumerate(sorted(repos, key=lambda r: r.created_at, reverse=True), start=1):
              line = f"{i}. [{repo.name}]({repo.html_url}) - {repo.description or 'No description.'}"
              project_lines.append(line)

          project_section = "\\n".join(project_lines[:30])  # Top 30 repos

          readme_content = f"""# 🚀 Auto-Generated README_2.md

## 👋 Hello, I'm Anil Sherikar!

🚀 Developer | AI Enthusiast | Automation Expert

---

## 🚀 Dynamic Projects

{project_section}

---

## 📢 Auto-updated on GitHub Actions
"""

          with open("README_2.md", "w", encoding="utf-8") as f:
              f.write(readme_content)
          EOF

          python generate.py

      - name: 📦 Commit & Push if README_2.md Changed
        run: |
          git config --global user.name "anilss147"
          git config --global user.email "anil@example.com"

          if [[ `git status --porcelain README_2.md` ]]; then
            git add README_2.md
            git commit -m "📦 Auto-update README_2.md with latest projects"
            git push
          else
            echo "✅ README_2.md is already up to date. No changes to commit."
          fi
